/// Please use the following editor setup for this file:

// Tab size=4; Tabs as spaces; Clean up trailing whitepsace
// 'make proto' will run clang-format to fix formatiing
syntax = "proto3";

option go_package = "api";

import "google/api/annotations.proto";
import "google/protobuf/timestamp.proto";
import "github.com/gogo/protobuf/gogoproto/gogo.proto";
import "pkg/apis/v1/common.proto";

option (gogoproto.populate_all) = true;
option (gogoproto.equal_all) = true;
option (gogoproto.testgen_all) = true;

message OrganizationObject {
    Metadata metadata = 1 [ (gogoproto.embed) = true ];
}

message ClusterInfo {
    PXConfig px_config = 1 [ (gogoproto.jsontag) = "pxconfig" ];
    string kubeconfig = 2 [
        (gogoproto.jsontag) = "kubeconfig",
        (gogoproto.moretags) = "secure:\"true\""
    ];
    string cloud_credential = 3;
    StatusInfo status = 4;
    // delete_backups will determine whether the backups
    // belong to given cluster needs to be deleted or not.
    bool delete_backups = 5;
    // delete_restores will determine whether the restore
    // belong to given cluster needs to be deleted or not.
    bool delete_restores = 6;

    // Message for maintaing status of the cluster.
    message StatusInfo {
        enum Status {
            Invalid = 0;
            Online = 1;
            Offline = 2;
            DeletePending = 3;
        }
        Status status = 1;
        string reason = 2;
    }
}

message ClusterObject {
    Metadata metadata = 1 [ (gogoproto.embed) = true ];
    ClusterInfo clusterInfo = 2
        [ (gogoproto.jsontag) = "clusterinfo", (gogoproto.embed) = true ];
}

message PXConfig {
    string access_token = 1 [ (gogoproto.jsontag) = "accesstoken" ];
}

message AWSConfig {
    string access_key = 1 [ (gogoproto.jsontag) = "accesskey" ];
    string secret_key = 2 [
        (gogoproto.jsontag) = "secretkey",
        (gogoproto.moretags) = "secure:\"true\""
    ];
}

message S3Config {
    string endpoint = 1;
    string region = 2;
    bool disable_ssl = 3;
    bool disable_path_style = 4;
    string storage_class = 5;
}

message AzureConfig {
    string account_name = 1;
    string account_key = 2 [
        (gogoproto.jsontag) = "accountkey",
        (gogoproto.moretags) = "secure:\"true\""
    ];
    string client_secret = 3 [
        (gogoproto.jsontag) = "clientsecret",
        (gogoproto.moretags) = "secure:\"true\""
    ];
    string client_id = 4 [
        (gogoproto.jsontag) = "clientid",
        (gogoproto.moretags) = "secure:\"true\""
    ];
    string tenant_id = 5 [
        (gogoproto.jsontag) = "tenantid",
        (gogoproto.moretags) = "secure:\"true\""
    ];
    // TODO: Need to see if this has to be here or in the backup object.
    string subscription_id = 6 [
        (gogoproto.jsontag) = "subscriptionid",
        (gogoproto.moretags) = "secure:\"true\""
    ];
}

message GoogleConfig {
    string project_id = 1;
    string json_key = 2 [
        (gogoproto.jsontag) = "jsonkey",
        (gogoproto.moretags) = "secure:\"true\""
    ];
}

message CloudCredentialInfo {
    enum Type {
        Invalid = 0;
        AWS = 1;
        Azure = 2;
        Google = 3;
    }

    Type type = 1;
    oneof config {
        AWSConfig aws_config = 100;
        AzureConfig azure_config = 101;
        GoogleConfig google_config = 102;
    }
}

message CloudCredentialObject {
    Metadata metadata = 1
        [ (gogoproto.jsontag) = "metadata", (gogoproto.embed) = true ];
    CloudCredentialInfo cloud_credential_info = 2;
}

message SchedulePolicyInfo {
    message IncrementalCount {
        uint64 count = 1 [ (gogoproto.jsontag) = "count" ];
    }

    message IntervalPolicy {
        // Interval in minutes at which an action should be triggered.
        int64 minutes = 1;
        // Number of objects to retain for interval policy, default value is 10.
        int64 retain = 2;
        // Number of incremental snapshots to take before taking a full
        // snapshot.
        IncrementalCount incremental_count = 3;
    }

    message DailyPolicy {
        // Time, when the policy should be triggered. Expected format is
        // time.Kitchen eg 12:04PM or 12:04pm.
        string time = 1;
        // Number of objects to retain for daily policy, default value is 10.
        int64 retain = 2;
        // Number of incremental snapshots to take before taking a full
        // snapshot.
        IncrementalCount incremental_count = 3;
    }

    message WeeklyPolicy {
        // Day of the week when the policy should be triggered.
        // For example, sunday or sun
        string day = 1;
        // Time, when the policy should be triggered. Expected format is
        // time.Kitchen eg 12:04PM or 12:04pm.
        string time = 2;
        // Number of objects to retain for weekly policy, default value is 10.
        int64 retain = 3;
        // Number of incremental snapshots to take before taking a full
        // snapshot.
        IncrementalCount incremental_count = 4;
    }

    message MonthlyPolicy {
        // Date of the month when the policy should be triggered. If a given
        // date
        // doesn't exist in a month it'll rollover to the next date of the
        // month.
        // For example if 31 is specified, it'll trigger on either 1st or 2nd
        // March
        // depending on if it is a leap year.
        int64 date = 1;
        // Time, when the policy should be triggered. Expected format is
        // time.Kitchen eg 12:04PM or 12:04pm.
        string time = 2;
        // Number of objects to retain for monthly policy, default value is 10.
        int64 retain = 3;
        // Number of incremental snapshots to take before taking a full
        // snapshot.
        IncrementalCount incremental_count = 4;
    }

    IntervalPolicy interval = 1;
    DailyPolicy daily = 2;
    WeeklyPolicy weekly = 3;
    MonthlyPolicy monthly = 4;
    // list of backup schedule object that uses this schedule policy.
    repeated string backup_schedule = 5;
}

message SchedulePolicyObject {
    Metadata metadata = 1
        [ (gogoproto.jsontag) = "metadata", (gogoproto.embed) = true ];
    SchedulePolicyInfo schedule_policy_info = 2 [ (gogoproto.embed) = true ];
}

message BackupScheduleInfo {
    string schedule_policy = 1;
    bool suspend = 2;
    ReclaimPolicyType reclaim_policy = 3;
    map<string, StatusInfoList> backup_status = 4;
    // Name of BackupLocation
    string backup_location = 5;
    // Name of Cluster
    string cluster = 6;
    // Namespaces to backup. Only an admin can provide multiple namespaces
    repeated string namespaces = 7;
    // Label selectors to choose resources
    map<string, string> label_selectors = 8;
    string pre_exec_rule = 9;
    string post_exec_rule = 10;
    bool delete_backups = 11;
    StatusInfo status = 12;
    SuspendedBy suspended_by = 13;
    repeated ResourceInfo include_resources = 14;

    message SuspendedBy {
        Source source = 1;
        enum Source {
            Invalid = 0;
            User = 1;
            LicenseCheck = 2;
        }
    }

    enum ReclaimPolicyType {
        Invalid = 0;
        Delete = 1;
        Retain = 2;
    }
    message StatusInfoList { repeated StatusInfo status = 1; }
    message StatusInfo {
        // backup name
        string backup_name = 1;
        google.protobuf.Timestamp create_time = 2;
        google.protobuf.Timestamp finish_time = 3;
        Status status = 4;
        string Reason = 5;
        enum Status {
            Invalid = 0;
            Pending = 1;
            InProgress = 2;
            Aborted = 3;
            Failed = 4;
            Deleting = 5;
            Success = 6;
            Captured = 7;
            PartialSuccess = 8;
            DeletePending = 9;
        }
    }
}

message BackupScheduleObject {
    Metadata metadata = 1
        [ (gogoproto.jsontag) = "metadata", (gogoproto.embed) = true ];
    BackupScheduleInfo backup_schedule_info = 2 [ (gogoproto.embed) = true ];
}

message BackupLocationInfo {
    enum Type {
        Invalid = 0;
        S3 = 1;
        Azure = 2;
        Google = 3;
    }

    Type type = 1;
    string path = 2;
    string encryption_key = 3 [
        (gogoproto.jsontag) = "encryptionkey",
        (gogoproto.moretags) = "secure:\"true\""
    ];
    string cloud_credential = 4;
    StatusInfo status = 5;
    bool delete_backups = 6;
    bool validate_cloud_credential = 7;
    oneof config { S3Config s3_config = 100; }
    // Message for maintaing status of the object.
    message StatusInfo {
        enum Status {
            Invalid = 0;
            Valid = 1;
            DeletePending = 2;
        }

        Status status = 1;
        string reason = 2;
    }
}

message BackupLocationObject {
    Metadata metadata = 1
        [ (gogoproto.jsontag) = "metadata", (gogoproto.embed) = true ];
    BackupLocationInfo backup_location_info = 2;
}

message ResourceInfo {
    string name = 1;
    string namespace = 2;
    string group = 3;
    string kind = 4;
    string version = 5;
}

message BackupInfo {
    // Name of BackupLocation
    string backup_location = 1;
    // Name of Cluster
    string cluster = 2;
    // Namespaces to backup. Only an admin can provide multiple namespaces
    repeated string namespaces = 3;
    // Label selectors to choose resources
    map<string, string> label_selectors = 4;
    StatusInfo status = 5;
    repeated ResourceInfo resources = 6;
    repeated Volume volumes = 7;
    string backup_path = 8;
    Stage stage = 9;
    string pre_exec_rule = 10;
    string post_exec_rule = 11;
    // Name of the backup schedule, if the backup was taken by schedule through
    // px-backup.
    // Otherwise it will be empty.
    BackupSchedule backup_schedule = 12;
    string cr_name = 13;
    uint64 total_size = 14;
    // Reference to cloud credential object used for backup
    string cloud_credential = 15;
    repeated ResourceInfo include_resources = 16;

    enum Stage {
        Invalid = 0;
        Initial = 1;
        PreExecRule = 2;
        PostExecRule = 3;
        Volumes = 4;
        Applications = 5;
        Final = 6;
    }

    message BackupSchedule {
        string uid = 1;
        string name = 2;
    }

    message Volume {
        string name = 1;
        string namespace = 2;
        string pvc = 3;
        string backup_id = 4;
        StatusInfo status = 5;
        string driver_name = 6;
        repeated string zones = 7;
        map<string, string> options = 8;
        uint64 total_size = 9;
        // actual size of the backup
        // incase of invremental, it's the incremental backup size
        uint64 actual_size = 10;
    }

    // Message for maintaing status of the object.
    message StatusInfo {
        enum Status {
            Invalid = 0;
            Pending = 1;
            InProgress = 2;
            Aborted = 3;
            Failed = 4;
            Deleting = 5;
            Success = 6;
            Captured = 7;
            PartialSuccess = 8;
            DeletePending = 9;
            CloudBackupMissing = 10;
        }

        Status status = 1;
        string reason = 2;
    }
}

// Message for Backup object which will be stored in Datastore.
message BackupObject {
    Metadata metadata = 1 [ (gogoproto.embed) = true ];
    BackupInfo backup_info = 2 [ (gogoproto.embed) = true ];
}

// Message for passing pre and post exec rules for backup
message RulesInfo {
    repeated RuleItem rules = 1 [ (gogoproto.moretags) = "yaml:\"rules\"" ];

    message RuleItem {
        map<string, string> pod_selector = 1
            [ (gogoproto.moretags) = "yaml:\"podSelector\"" ];
        repeated Action actions = 2
            [ (gogoproto.moretags) = "yaml:\"actions\"" ];
        string container = 3;
    }

    message Action {
        bool background = 1 [ (gogoproto.moretags) = "yaml:\"background\"" ];
        bool run_in_single_pod = 2
            [ (gogoproto.moretags) = "yaml:\"runInSinglePod\"" ];
        string value = 3;
    }
}

message RuleObject {
    Metadata metadata = 1 [ (gogoproto.embed) = true ];
    RulesInfo rules_info = 2 [ (gogoproto.embed) = true ];
}

message ReplacePolicy {
    enum Type {
        Invalid = 0;
        Retain = 1;
        Delete = 2;
    }
}

// Message for restore info
message RestoreInfo {
    // Name of backup to restore from
    string backup = 1;
    // Name of backup location to restore from
    string backup_location = 2;
    // Label selectors to choose resources
    map<string, string> label_selectors = 3;
    // Namespace Mapping
    map<string, string> namespace_mapping = 4;
    // Restore replace policy type ("delete"/"retain")
    ReplacePolicy.Type replace_policy = 5;

    StatusInfo status = 6;
    repeated RestoredResource resources = 7;
    repeated Volume volumes = 8;
    // Name of the cluster
    string cluster = 9;
    repeated string include_optional_resource_types = 10;
    uint64 total_size = 11;
    repeated ResourceInfo include_resources = 12;

    message RestoredResource {
        string name = 1;
        string namespace = 2;
        string group = 3;
        string kind = 4;
        string version = 5;
        StatusInfo status = 6;
    }

    message Volume {
        string pvc = 1;
        string source_namespace = 2;
        string source_volume = 3;
        string restore_volume = 4;
        StatusInfo status = 5;
        string driver_name = 6;
        repeated string zones = 7;
        map<string, string> options = 8;
        uint64 total_size = 9;
    }

    // Message for maintaing status of the object.
    message StatusInfo {
        enum Status {
            Invalid = 0;
            Pending = 1;
            InProgress = 2;
            Aborted = 3;
            Failed = 4;
            Deleting = 5;
            Success = 6;
            Retained = 7;
            PartialSuccess = 8;
        }

        Status status = 1;
        string reason = 2;
    }
}

// Message for Restore object which will be stored in Datastore.
message RestoreObject {
    Metadata metadata = 1 [ (gogoproto.embed) = true ];
    RestoreInfo restore_info = 2 [ (gogoproto.embed) = true ];
}

service Health {
    // Status checks the health of the server
    rpc Status(HealthStatusRequest) returns (HealthStatusResponse) {
        option (google.api.http) = {
            get : "/v1/health"
        };
    }
}

message HealthStatusRequest {}
message HealthStatusResponse {}

message TimeRange {
    google.protobuf.Timestamp start_time = 1;
    google.protobuf.Timestamp end_time = 2;
}

message EnumerateOptions {
    // label selectors for the object for filtering
    map<string, string> labels = 1;
    // max objects to fetch
    uint64 max_objects = 2;
    // Time range for which to return objects
    TimeRange time_range = 3;
    // Filter to use for name of objects. Any object that contains the filter
    // will be returned
    string name_filter = 4;
    // Filter to use for cluster name of objects. Any object that contains the
    // filter will be returned
    string cluster_name_filter = 5;
    uint64 object_index = 6;
}

service SchedulePolicy {
    // Create creates new schedule policy.
    rpc Create(SchedulePolicyCreateRequest)
        returns (SchedulePolicyCreateResponse) {
        option (google.api.http) = {
            post : "/v1/schedulepolicy"
            body : "*"
        };
    }

    // Update given schedule policy details
    rpc Update(SchedulePolicyUpdateRequest)
        returns (SchedulePolicyUpdateResponse) {
        option (google.api.http) = {
            put : "/v1/schedulepolicy"
            body : "*"
        };
    }

    // Enumerate returns a list of schedule policy
    rpc Enumerate(SchedulePolicyEnumerateRequest)
        returns (SchedulePolicyEnumerateResponse) {
        option (google.api.http) = {
            get : "/v1/schedulepolicy/{org_id}"
        };
    }

    // Inspect returns detail information about a specified schedule policy
    rpc Inspect(SchedulePolicyInspectRequest)
        returns (SchedulePolicyInspectResponse) {
        option (google.api.http) = {
            get : "/v1/schedulepolicy/{org_id}/{name}"
        };
    }

    // Delete removes a schedule policy
    rpc Delete(SchedulePolicyDeleteRequest)
        returns (SchedulePolicyDeleteResponse) {
        option (google.api.http) = {
            delete : "/v1/schedulepolicy/{org_id}/{name}"
        };
    }
}

// Define SchedulePolicyCreateRequest struct
message SchedulePolicyCreateRequest {
    CreateMetadata metadata = 1 [ (gogoproto.embed) = true ];
    SchedulePolicyInfo schedule_policy = 2;
}
// Define SchedulePolicyCreateResponse struct
message SchedulePolicyCreateResponse {}
// Define SchedulePolicyUpdateRequest struct
message SchedulePolicyUpdateRequest {
    CreateMetadata metadata = 1 [ (gogoproto.embed) = true ];
    SchedulePolicyInfo schedule_policy = 2;
}
// Define SchedulePolicyUpdateResponse struct
message SchedulePolicyUpdateResponse {}
// Define SchedulePolicyEnumerateRequest struct
message SchedulePolicyEnumerateRequest {
    string org_id = 1;
    // label selectors for the object for filtering
    map<string, string> labels = 2;
}
// Define SchedulePolicyEnumerateResponse struct
message SchedulePolicyEnumerateResponse {
    repeated SchedulePolicyObject schedule_policies = 1;
}
// Define SchedulePolicyInspectRequest struct
message SchedulePolicyInspectRequest {
    string org_id = 1;
    string name = 2;
}
// Define SchedulePolicyInspectResponse struct
message SchedulePolicyInspectResponse {
    SchedulePolicyObject schedule_policy = 1;
}
// Define SchedulePolicyDeleteRequest struct
message SchedulePolicyDeleteRequest {
    string org_id = 1;
    string name = 2;
}
// Define SchedulePolicyDeleteResponse struct
message SchedulePolicyDeleteResponse {}

service BackupSchedule {
    // Create creates new backup schedule
    rpc Create(BackupScheduleCreateRequest)
        returns (BackupScheduleCreateResponse) {
        option (google.api.http) = {
            post : "/v1/backupschedule"
            body : "*"
        };
    }

    // Update updates a backup schedule
    rpc Update(BackupScheduleUpdateRequest)
        returns (BackupScheduleUpdateResponse) {
        option (google.api.http) = {
            put : "/v1/backupschedule"
            body : "*"
        };
    }

    // Enumerate returns a list of backup schedule
    rpc Enumerate(BackupScheduleEnumerateRequest)
        returns (BackupScheduleEnumerateResponse) {
        option (google.api.http) = {
            get : "/v1/backupschedule/{org_id}"
        };
    }

    // Inspect returns detail information about a specified backup schedule
    rpc Inspect(BackupScheduleInspectRequest)
        returns (BackupScheduleInspectResponse) {
        option (google.api.http) = {
            get : "/v1/backupschedule/{org_id}/{name}"
        };
    }

    // Delete removes a backup schedule
    rpc Delete(BackupScheduleDeleteRequest)
        returns (BackupScheduleDeleteResponse) {
        option (google.api.http) = {
            delete : "/v1/backupschedule/{org_id}/{name}"
        };
    }
}

// Define BackupScheduleCreateRequest struct
message BackupScheduleCreateRequest {
    CreateMetadata metadata = 1 [ (gogoproto.embed) = true ];
    string schedule_policy = 2;
    BackupScheduleInfo.ReclaimPolicyType reclaim_policy = 3;
    // Name of BackupLocation
    string backup_location = 4;
    // Name of Cluster
    string cluster = 5;
    // Namespaces to backup. Only an admin can provide multiple namespaces
    repeated string namespaces = 6;
    // Label selectors to choose resources
    map<string, string> label_selectors = 7;
    string pre_exec_rule = 8;
    string post_exec_rule = 9;
    // List of resources to backup (optional)
    repeated ResourceInfo include_resources = 10;
}

// Define BackupScheduleCreateResponse struct
message BackupScheduleCreateResponse {}

// Define BackupScheduleUpdateRequest struct
message BackupScheduleUpdateRequest {
    CreateMetadata metadata = 1 [ (gogoproto.embed) = true ];
    string schedule_policy = 2;
    BackupScheduleInfo.ReclaimPolicyType reclaim_policy = 3;
    // Name of BackupLocation
    string backup_location = 4;
    // Name of Cluster
    string cluster = 5;
    // Namespaces to backup. Only an admin can provide multiple namespaces
    repeated string namespaces = 6;
    // Label selectors to choose resources
    map<string, string> label_selectors = 7;
    string pre_exec_rule = 8;
    string post_exec_rule = 9;
    bool suspend = 10;
    // List of resources to backup (optional)
    repeated ResourceInfo include_resources = 11;
}

// Define BackupScheduleUpdateResponse struct
message BackupScheduleUpdateResponse {}
// Define BackupScheduleEnumerateRequest struct
message BackupScheduleEnumerateRequest {
    string org_id = 1;
    // label selectors for the object for filtering
    map<string, string> labels = 2;
}

// Define BackupScheduleEnumerateResponse struct
message BackupScheduleEnumerateResponse {
    repeated BackupScheduleObject backup_schedules = 1;
}

// Define BackupScheduleInspectRequest struct
message BackupScheduleInspectRequest {
    string org_id = 1;
    string name = 2;
}

// Define BackupScheduleInspectResponse struct
message BackupScheduleInspectResponse {
    BackupScheduleObject backup_schedule = 1;
}

// Define BackupScheduleDeleteRequest struct
message BackupScheduleDeleteRequest {
    string org_id = 1;
    string name = 2;
    // delete_backups indicates whether the cloud backup files need to
    // be deleted or retained.
    bool delete_backups = 3;
}

// Define BackupScheduleDeleteResponse struct
message BackupScheduleDeleteResponse {}

service Cluster {

    // Create creates a new cluster
    rpc Create(ClusterCreateRequest) returns (ClusterCreateResponse) {
        option (google.api.http) = {
            post : "/v1/cluster"
            body : "*"
        };
    }

    // Update given cluster details
    rpc Update(ClusterUpdateRequest) returns (ClusterUpdateResponse) {
        option (google.api.http) = {
            put : "/v1/cluster"
            body : "*"
        };
    }

    // Enumerate returns a list of clusters
    rpc Enumerate(ClusterEnumerateRequest) returns (ClusterEnumerateResponse) {
        option (google.api.http) = {
            get : "/v1/cluster/{org_id}"
        };
    }

    // Inspect returns detail information about a specified cluster
    rpc Inspect(ClusterInspectRequest) returns (ClusterInspectResponse) {
        option (google.api.http) = {
            get : "/v1/cluster/{org_id}/{name}"
        };
    }

    // Delete removes a cluster
    rpc Delete(ClusterDeleteRequest) returns (ClusterDeleteResponse) {
        option (google.api.http) = {
            delete : "/v1/cluster/{org_id}/{name}"
        };
    }
}

// Define ClusterCreateRequest struct
message ClusterCreateRequest {
    CreateMetadata metadata = 1 [ (gogoproto.embed) = true ];
    PXConfig px_config = 2 [ (gogoproto.jsontag) = "pxconfig" ];
    string kubeconfig = 3 [
        (gogoproto.jsontag) = "kubeconfig",
        (gogoproto.moretags) = "secure:\"true\""
    ];
    string cloud_credential = 4;
}

// Define ClusterCreateResponse struct
message ClusterCreateResponse {}

// Define ClusterUpdateRequest struct
message ClusterUpdateRequest {
    CreateMetadata metadata = 1 [ (gogoproto.embed) = true ];
    PXConfig px_config = 2 [ (gogoproto.jsontag) = "pxconfig" ];
    string kubeconfig = 3 [
        (gogoproto.jsontag) = "kubeconfig",
        (gogoproto.moretags) = "secure:\"true\""
    ];
    string cloud_credential = 4;
}

// Define ClusterUpdateResponse struct
message ClusterUpdateResponse {}

// Define ClusterEnumerateRequest struct
message ClusterEnumerateRequest {
    string org_id = 1;
    // label selectors for the object for filtering
    map<string, string> labels = 2;
    bool include_secrets = 3;
}

// Define ClusterEnumerateResponse struct
message ClusterEnumerateResponse { repeated ClusterObject clusters = 1; }

// Define ClusterInspectRequest struct
message ClusterInspectRequest {
    string org_id = 1;
    string name = 2;
    bool include_secrets = 3;
}

// Define ClusterInspectResponse struct
message ClusterInspectResponse { ClusterObject cluster = 1; }

// Define ClusterDeleteRequest struct
message ClusterDeleteRequest {
    string org_id = 1;
    string name = 2;
    // delete_backups indicates whether the backup related to cluster need to
    // be deleted or retained.
    bool delete_backups = 3;
    // delete_restores indicates whether the restore related to cluster  need to
    // be deleted or retained.
    bool delete_restores = 4;
}

// Define ClusterInspectResponse struct
message ClusterDeleteResponse {}

service CloudCredential {
    // Create creates new cloud credential
    rpc Create(CloudCredentialCreateRequest)
        returns (CloudCredentialCreateResponse) {
        option (google.api.http) = {
            post : "/v1/cloudcredential"
            body : "*"
        };
    }

    // Update given cloud credential details
    rpc Update(CloudCredentialUpdateRequest)
        returns (CloudCredentialUpdateResponse) {
        option (google.api.http) = {
            put : "/v1/cloudcredential"
            body : "*"
        };
    }

    // Enumerate returns a list of cloud credentials
    rpc Enumerate(CloudCredentialEnumerateRequest)
        returns (CloudCredentialEnumerateResponse) {
        option (google.api.http) = {
            get : "/v1/cloudcredential/{org_id}"
        };
    }

    // Inspect returns detailed information about the specified cloud credential
    rpc Inspect(CloudCredentialInspectRequest)
        returns (CloudCredentialInspectResponse) {
        option (google.api.http) = {
            get : "/v1/cloudcredential/{org_id}/{name}"
        };
    }

    // Delete removes a cloud credential
    rpc Delete(CloudCredentialDeleteRequest)
        returns (CloudCredentialDeleteResponse) {
        option (google.api.http) = {
            delete : "/v1/cloudcredential/{org_id}/{name}"
        };
    }
}

// Define CloudCredentialCreateRequest struct
message CloudCredentialCreateRequest {
    CreateMetadata metadata = 1 [ (gogoproto.embed) = true ];
    CloudCredentialInfo cloud_credential = 2;
}

// Define CloudCredentialCreateResponse struct
message CloudCredentialCreateResponse {}

// Define CloudCredentialUpdateRequest struct
message CloudCredentialUpdateRequest {
    CreateMetadata metadata = 1 [ (gogoproto.embed) = true ];
    CloudCredentialInfo cloud_credential = 2;
}

// Define CloudCredentialUpdateResponse struct
message CloudCredentialUpdateResponse {}

// Define CloudCredentialEnumerateRequest struct
message CloudCredentialEnumerateRequest {
    string org_id = 1;
    bool include_secrets = 2;
}

// Define CloudCredentialEnumerateResponse struct
message CloudCredentialEnumerateResponse {
    repeated CloudCredentialObject cloud_credentials = 1;
}

// Define CloudCredentialInspectRequest struct
message CloudCredentialInspectRequest {
    string org_id = 1;
    string name = 2;
    bool include_secrets = 3;
}

// Define CloudCredentialInspectResponse struct
message CloudCredentialInspectResponse {
    CloudCredentialObject cloud_credential = 1;
}

// Define CloudCredentialDeleteRequest struct
message CloudCredentialDeleteRequest {
    string org_id = 1;
    string name = 2;
}

// Define CloudCredentialInspectResponse struct
message CloudCredentialDeleteResponse {}

service BackupLocation {
    // Create creates new backup location
    rpc Create(BackupLocationCreateRequest)
        returns (BackupLocationCreateResponse) {
        option (google.api.http) = {
            post : "/v1/backuplocation"
            body : "*"
        };
    }

    // Update given backup location details
    rpc Update(BackupLocationUpdateRequest)
        returns (BackupLocationUpdateResponse) {
        option (google.api.http) = {
            put : "/v1/backuplocation"
            body : "*"
        };
    }

    // Enumerate returns a list of backup locations
    rpc Enumerate(BackupLocationEnumerateRequest)
        returns (BackupLocationEnumerateResponse) {
        option (google.api.http) = {
            get : "/v1/backuplocation/{org_id}"
        };
    }

    // Inspect returns detailed information about a specified backup location
    rpc Inspect(BackupLocationInspectRequest)
        returns (BackupLocationInspectResponse) {
        option (google.api.http) = {
            get : "/v1/backuplocation/{org_id}/{name}"
        };
    }

    // Delete removes a backup location
    rpc Delete(BackupLocationDeleteRequest)
        returns (BackupLocationDeleteResponse) {
        option (google.api.http) = {
            delete : "/v1/backuplocation/{org_id}/{name}"
        };
    }

    // Verify if a backup location is valid
    rpc Validate(BackupLocationValidateRequest)
        returns (BackupLocationValidateResponse) {
        option (google.api.http) = {
            post : "/v1/backuplocation/validate"
            body : "*"
        };
    }
}

// Define BackupLocationCreateRequest struct
message BackupLocationCreateRequest {
    CreateMetadata metadata = 1 [ (gogoproto.embed) = true ];
    BackupLocationInfo backup_location = 2;
}

// Define BackupLocationCreateResponse struct
message BackupLocationCreateResponse {}

// Define BackupLocationUpdateRequest struct
message BackupLocationUpdateRequest {
    CreateMetadata metadata = 1 [ (gogoproto.embed) = true ];
    BackupLocationInfo backup_location = 2;
}

// Define BackupLocationUpdateResponse struct
message BackupLocationUpdateResponse {}

// Define BackupLocationEnumerateRequest struct
message BackupLocationEnumerateRequest {
    string org_id = 1;
    // label selectors for the object for filtering
    map<string, string> labels = 2;
}

// Define BackupLocationEnumerateResponse struct
message BackupLocationEnumerateResponse {
    repeated BackupLocationObject backup_locations = 1;
}

// Define BackupLocationInspectRequest struct
message BackupLocationInspectRequest {
    string org_id = 1;
    string name = 2;
}

// Define BackupLocationInspectResponse struct
message BackupLocationInspectResponse {
    BackupLocationObject backup_location = 1;
}

// Define BackupLocationDeleteRequest struct
message BackupLocationDeleteRequest {
    string org_id = 1;
    string name = 2;
    // delete_backups indicates whether the cloud backup files need to
    // be deleted or retained.
    bool delete_backups = 3;
}

// Define BackupLocationDeleteResponse struct
message BackupLocationDeleteResponse {}

// Define BackupLocationValidateRequest struct
message BackupLocationValidateRequest {
    string org_id = 1;
    string name = 2;
}

// Define BackupLocationValidateResponse struct
message BackupLocationValidateResponse {}

service Metrics {
    rpc Inspect(MetricsInspectRequest) returns (MetricsInspectResponse) {
        option (google.api.http) = {
            get : "/v1/metrics/{org_id}"
        };
    }
}

message MetricsInspectRequest { string org_id = 1; }

message MetricsInspectResponse {
    repeated Stats stats = 1;
    message Stats {
        string cluster = 1;
        uint64 num_namespaces = 2;
        uint64 total_backup_size = 3;
        uint64 num_schedules = 4;
    }
}

service Backup {
    // Create creates a new backup object
    rpc Create(BackupCreateRequest) returns (BackupCreateResponse) {
        option (google.api.http) = {
            post : "/v1/backup"
            body : "*"
        };
    }

    // Update given backup details
    rpc Update(BackupUpdateRequest) returns (BackupUpdateResponse) {
        option (google.api.http) = {
            put : "/v1/backup"
            body : "*"
        };
    }

    // Enumerate returns a list of objects
    rpc Enumerate(BackupEnumerateRequest) returns (BackupEnumerateResponse) {
        option (google.api.http) = {
            get : "/v1/backup/{org_id}"
        };
    }

    // Inspect returns detail information about a specified object
    rpc Inspect(BackupInspectRequest) returns (BackupInspectResponse) {
        option (google.api.http) = {
            get : "/v1/backup/{org_id}/{name}"
        };
    }

    // Delete triggers delete of a backup
    rpc Delete(BackupDeleteRequest) returns (BackupDeleteResponse) {
        option (google.api.http) = {
            delete : "/v1/backup/{org_id}/{name}"
        };
    }
}

// Request message structure for backup create
message BackupCreateRequest {
    CreateMetadata metadata = 1 [ (gogoproto.embed) = true ];
    // Name or UID + orgid of BackupLocation
    string backup_location = 2;
    // Name or UID of Cluster
    string cluster = 3;
    // Namespaces to backup. Only an admin can provide multiple namespaces
    repeated string namespaces = 4;
    // Label selectors to choose resources
    map<string, string> label_selectors = 5;
    // Pre check rule to run before backup is started
    string pre_exec_rule = 6;
    // Post check rule to run after backup is completed
    string post_exec_rule = 7;
    // List of resources to backup (optional)
    repeated ResourceInfo include_resources = 8;
}

// Response message structure for backup create
message BackupCreateResponse {}

// Define BackupUpdateRequest struct
message BackupUpdateRequest {
    CreateMetadata metadata = 1 [ (gogoproto.embed) = true ];
    // Reference to cloud credential object used for backup
    string cloud_credential = 2;
}

// Define BackupUpdateResponse struct
message BackupUpdateResponse {}

//  Request message strcuture for enumerate object
message BackupEnumerateRequest {
    // Organization id
    string org_id = 1;
    // Optional arguments for enumeration
    EnumerateOptions enumerate_options = 2 [ (gogoproto.embed) = true ];
}

//  Response message structure for enumerate create
message BackupEnumerateResponse {
    repeated BackupObject backups = 1;
    uint64 total_count = 2;
    bool complete = 3;
}

// Request message strcuture for object inspect
message BackupInspectRequest {
    string name = 1;
    string org_id = 2;
}

// Response message strcuture for object inspect
message BackupInspectResponse { BackupObject backup = 1; }

// Request message strcuture for object delete
message BackupDeleteRequest {
    string name = 1;
    string org_id = 2;
}

// Response message strcuture for object delete
message BackupDeleteResponse {}

service Restore {
    // Create creates new restore object in datastore
    // It will also trigger a restore operation on the target cluster
    rpc Create(RestoreCreateRequest) returns (RestoreCreateResponse) {
        option (google.api.http) = {
            post : "/v1/restore"
            body : "*"
        };
    }

    // Update given restore details
    rpc Update(RestoreUpdateRequest) returns (RestoreUpdateResponse) {
        option (google.api.http) = {
            put : "/v1/restore"
            body : "*"
        };
    }

    // Enumerate returns a list of restore objects
    rpc Enumerate(RestoreEnumerateRequest) returns (RestoreEnumerateResponse) {
        option (google.api.http) = {
            get : "/v1/restore/{org_id}"
        };
    }

    // Inspect returns detailed information about specified restore object
    rpc Inspect(RestoreInspectRequest) returns (RestoreInspectResponse) {
        option (google.api.http) = {
            get : "/v1/restore/{org_id}/{name}"
        };
    }

    // Delete removes a restore object
    rpc Delete(RestoreDeleteRequest) returns (RestoreDeleteResponse) {
        option (google.api.http) = {
            delete : "/v1/restore/{org_id}/{name}"
        };
    }
}

// Define RestoreCreateRequest struct
message RestoreCreateRequest {
    CreateMetadata metadata = 1 [ (gogoproto.embed) = true ];
    // uid or name of backup
    string backup = 2;
    // uid or name of cluster
    string cluster = 3;
    // mapping of the namespaces from the backup to which restore should be done
    map<string, string> namespace_mapping = 4;
    // replace policy to use if the resource already exists
    ReplacePolicy.Type replace_policy = 5;
    // optional resource types to be restored (eg Jobs)
    repeated string include_optional_resource_types = 6;
    // List of resources to restore (optional)
    repeated ResourceInfo include_resources = 7;
}

// Define RestoreCreateResponse struct
message RestoreCreateResponse {}

// Define RestoreUpdateRequest struct
message RestoreUpdateRequest {
    CreateMetadata metadata = 1 [ (gogoproto.embed) = true ];
}

// Define RestoreUpdateResponse struct
message RestoreUpdateResponse {}

// Define RestoreEnumerateRequest struct
message RestoreEnumerateRequest {
    // Organization id
    string org_id = 1;
    // Optional arguments for enumeration
    EnumerateOptions enumerate_options = 2 [ (gogoproto.embed) = true ];
}

// Define RestoreEnumerateResponse struct
message RestoreEnumerateResponse {
    repeated RestoreObject restores = 1;
    uint64 total_count = 2;
    bool complete = 3;
}

// Define RestoreInspectRequest struct
message RestoreInspectRequest {
    string org_id = 1;
    string name = 2;
}

// Define RestoreInspectResponse struct
message RestoreInspectResponse { RestoreObject restore = 1; }
// Define RestoreDeleteRequest struct
message RestoreDeleteRequest {
    string org_id = 1;
    string name = 2;
}

// Define RestoreDeleteResponse struct
message RestoreDeleteResponse {}

service Organization {
    // Create creates new organization object in datastore
    rpc Create(OrganizationCreateRequest) returns (OrganizationCreateResponse) {
        option (google.api.http) = {
            post : "/v1/organization"
            body : "*"
        };
    }
    // Enumerate returns a list of organization object
    rpc Enumerate(OrganizationEnumerateRequest)
        returns (OrganizationEnumerateResponse) {
        option (google.api.http) = {
            get : "/v1/organization"
        };
    }

    // Inspect returns detailed information about specified organization object
    rpc Inspect(OrganizationInspectRequest)
        returns (OrganizationInspectResponse) {
        option (google.api.http) = {
            get : "/v1/organization/{name}"
        };
    }
}

// Define OrganizationCreateRequest struct
message OrganizationCreateRequest {
    CreateMetadata metadata = 1 [ (gogoproto.embed) = true ];
}

// Define OrganizationCreateResponse struct
message OrganizationCreateResponse {}

// Define OrganizationEnumerateRequest struct
message OrganizationEnumerateRequest {}

// Define OrganizationEnumerateResponse struct
message OrganizationEnumerateResponse {
    repeated OrganizationObject organizations = 1;
}

// Define OrganizationInspectRequest struct
message OrganizationInspectRequest { string name = 2; }

// Define OrganizationInspectResponse struct
message OrganizationInspectResponse { OrganizationObject organization = 1; }

// Request message for creating rules
message RuleCreateRequest {
    CreateMetadata metadata = 1 [ (gogoproto.embed) = true ];
    RulesInfo rules_info = 2;
}

message RuleCreateResponse {}

message RuleUpdateRequest {
    CreateMetadata metadata = 1 [ (gogoproto.embed) = true ];
    RulesInfo rules_info = 2;
}

// Define RuleUpdateResponse struct
message RuleUpdateResponse {}

// Define RuleEnumerateRequest struct
message RuleEnumerateRequest { string org_id = 1; }

// Define RuleEnumerateResponse struct
message RuleEnumerateResponse { repeated RuleObject rules = 1; }

// Define RuleInspectRequest struct
message RuleInspectRequest {
    string org_id = 1;
    string name = 2;
}

// Define RuleInspectResponse struct
message RuleInspectResponse { RuleObject rule = 1; }

// Define RuleDeleteRequest struct
message RuleDeleteRequest {
    string org_id = 1;
    string name = 2;
}

// Define RuleDeleteResponse struct
message RuleDeleteResponse {}

service Rules {
    // Create creates new rule
    rpc Create(RuleCreateRequest) returns (RuleCreateResponse) {
        option (google.api.http) = {
            post : "/v1/rule"
            body : "*"
        };
    }

    // Update given rule details
    rpc Update(RuleUpdateRequest) returns (RuleUpdateResponse) {
        option (google.api.http) = {
            put : "/v1/rule"
            body : "*"
        };
    }

    // Enumerate returns a list of rules
    rpc Enumerate(RuleEnumerateRequest) returns (RuleEnumerateResponse) {
        option (google.api.http) = {
            get : "/v1/rule/{org_id}"
        };
    }

    // Inspect returns detailed information about the specified rule
    rpc Inspect(RuleInspectRequest) returns (RuleInspectResponse) {
        option (google.api.http) = {
            get : "/v1/rule/{org_id}/{name}"
        };
    }

    // Delete removes rule from px-backup
    rpc Delete(RuleDeleteRequest) returns (RuleDeleteResponse) {
        option (google.api.http) = {
            delete : "/v1/rule/{org_id}/{name}"
        };
    }
}

service Version {
    // Get gets the version of the server
    rpc Get(VersionGetRequest) returns (VersionGetResponse) {
        option (google.api.http) = {
            get : "/v1/version"
        };
    }
}

message VersionInfo {
    string major = 1;
    string minor = 2;
    string patch = 3;
    string git_commit = 4;
    string build_date = 5;
}

message VersionGetRequest {}

message VersionGetResponse {
    // version information of the server
    VersionInfo version = 1;
}

message LicenseActivateRequest {
    CreateMetadata metadata = 1 [ (gogoproto.embed) = true ];
    string activation_id = 2;
    bytes license_data = 3;
}

message LicenseActivateResponse {}

message LicenseInspectRequest { string org_id = 1; }

message LicenseInspectResponse { LicenseResponseInfo license_resp_info = 1; }

message LicenseResponseInfo {
    repeated FeatureInfo feature_info = 1;

    message FeatureInfo {
        // Feature name
        string name = 1;
        // Consumed count
        int64 consumed = 2;
        // License entitlement info
        repeated EntitlementInfo entitlement_info = 3;
    }

    message EntitlementInfo {
        // License count
        int64 count = 1;
        // Expiry time of license
        google.protobuf.Timestamp expires = 3;
        // Start time of license
        google.protobuf.Timestamp starts = 4;
    }
}

service License {
    // Activate activate a new license
    rpc Activate(LicenseActivateRequest) returns (LicenseActivateResponse) {
        option (google.api.http) = {
            post : "/v1/license"
            body : "*"
        };
    }

    // Enumerate returns a list of license for given cluster
    rpc Inspect(LicenseInspectRequest) returns (LicenseInspectResponse) {
        option (google.api.http) = {
            get : "/v1/license/{org_id}"
        };
    }
}
